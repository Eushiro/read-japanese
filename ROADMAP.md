# SanLang - Vision & Roadmap

## Project Evolution

**From:** Read Japanese (JLPT graded reader for Japanese learners)
**To:** **SanLang** - Multi-language exam prep platform with AI-powered personalization

---

## Core Brand Promise

**"Personalized Exam Prep"** - AI generates content tailored to YOUR vocabulary and YOUR target exam. Not generic study materials, but a learning path built around what you need to learn.

---

## Key Differentiators

| What We Do | What Others Do |
|------------|----------------|
| **Active output** - Create sentences, write analyses | Passive recall - flashcards, multiple choice |
| **AI verification** - Instant feedback on your writing | Right/wrong answers only |
| **Personalized content** - Stories/tests from your vocab | Generic content for everyone |
| **Exam-aligned** - Real test formats and rubrics | Gamified but not exam-focused |
| **Multi-modal** - Text, audio, images, YouTube | Usually single-modal |

---

## Supported Languages & Exams

Each language is a **separate track** with culturally appropriate content:

| Language | Target Exams | Content Themes | Phase |
|----------|--------------|----------------|-------|
| **Japanese** | JLPT N5-N1 | Daily life, manga culture, news, travel | MVP |
| **English** | TOEFL, SAT, GRE | Academic reading, test strategies, vocabulary | MVP |
| **French** | DELF/DALF, TCF | Culture, literature, daily life, news | MVP |
| **Chinese** | HSK 1-6, é«˜è€ƒ, ä¸­è€ƒ | Modern China, classical literature, news | Future |

**Note:** Chinese support is deferred to a future phase. MVP focuses on Japanese, English, and French.

---

## The Learning Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INPUT MODES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“– Reading        ğŸ§ Audio         ğŸ–¼ï¸ Images      ğŸ¬ YouTube     â”‚
â”‚  Graded stories    Narration        Describe &     Embedded      â”‚
â”‚  Exam passages     Dialogues        analyze        videos        â”‚
â”‚  News articles     Podcasts         scenes         + questions   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VOCABULARY CAPTURE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Automatic addition (reduce user effort):                        â”‚
â”‚  â€¢ Pre-populated most common word lists per level                â”‚
â”‚  â€¢ Auto-add words from mistakes in user's output                 â”‚
â”‚  â€¢ Auto-add unfamiliar words from content consumption            â”‚
â”‚                                                                  â”‚
â”‚  Manual addition:                                                â”‚
â”‚  â€¢ Tap words to save while reading/listening                     â”‚
â”‚  â€¢ Manual input for specific words                               â”‚
â”‚  â€¢ Import from external vocabulary lists                         â”‚
â”‚  â€¢ Extract from YouTube video transcripts                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLASHCARD SYSTEM (Anki-style SRS)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Auto-generated cards with:                                      â”‚
â”‚  â€¢ Word + reading + definition                                   â”‚
â”‚  â€¢ AI-generated example sentence (at your level)                 â”‚
â”‚  â€¢ Translation of the sentence                                   â”‚
â”‚  â€¢ Audio narration of the sentence                               â”‚
â”‚  â€¢ Periodic sentence refresh (keep it fresh)                     â”‚
â”‚                                                                  â”‚
â”‚  SRS Algorithm (FSRS - Anki's algorithm):                        â”‚
â”‚  â€¢ Use ts-fsrs library (github.com/open-spaced-repetition/ts-fsrsâ”‚
â”‚  â€¢ Mastered words still appear occasionally (prevents forgetting)â”‚
â”‚  â€¢ Algorithm adapts to individual learning patterns              â”‚
â”‚  â€¢ State: New â†’ Learning â†’ Review â†’ Relearning                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT PRACTICE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vocabulary-based output:                                        â”‚
â”‚  â€¢ Create a sentence using a target word                         â”‚
â”‚  â€¢ AI verifies grammar, usage, naturalness                       â”‚
â”‚  â€¢ Get feedback and corrections                                  â”‚
â”‚  â€¢ Words from mistakes auto-added to vocabulary                  â”‚
â”‚                                                                  â”‚
â”‚  Post-consumption output (after reading/watching/listening):     â”‚
â”‚  â€¢ Answer comprehension questions                                â”‚
â”‚  â€¢ Summarize what you consumed                                   â”‚
â”‚  â€¢ Predict what happens next                                     â”‚
â”‚  â€¢ Write analysis of content                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LISTENING PRACTICE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Multiple modes:                                                 â”‚
â”‚  â€¢ Audio + comprehension questions (JLPT/TOEFL listening style)  â”‚
â”‚  â€¢ Dictation - listen, type what you hear                        â”‚
â”‚  â€¢ Audio flashcards - hear word/sentence, recall meaning         â”‚
â”‚  â€¢ Shadowing with AI feedback - repeat after audio, AI evaluates â”‚
â”‚    pronunciation/fluency (requires speech recognition)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PERSONALIZED CONTENT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI generates content from YOUR vocabulary:                      â”‚
â”‚  â€¢ Stories featuring words you're learning                       â”‚
â”‚  â€¢ Mock tests with your vocabulary                               â”‚
â”‚  â€¢ Comprehension passages using target words                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MOCK EXAMS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI-generated tests in real exam formats:                        â”‚
â”‚  â€¢ JLPT: Reading + listening sections                            â”‚
â”‚  â€¢ TOEFL: Reading, listening, writing sections                   â”‚
â”‚  â€¢ SAT: Reading comprehension + essay                            â”‚
â”‚  â€¢ Scoring aligned with actual exam rubrics                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monetization: Subscription Tiers with Usage Limits

No visible "credits" - just subscription tiers with different usage allowances.
Users upgrade to unlock more usage, simpler UX than tracking credits.

| Tier | Price | What's Included |
|------|-------|-----------------|
| **Free** | $0 | Limited vocab, basic flashcards, X stories/month, Y AI checks/month |
| **Basic** | $X/mo | More stories, more AI verification, all content |
| **Pro** | $Y/mo | Higher limits, personalized story generation, mock tests |
| **Unlimited** | $Z/mo | No limits on AI generation, priority support |

Usage limits (example):
- Free: 50 AI sentence checks/month, 5 stories
- Basic: 200 AI checks/month, 20 stories, 5 personalized stories
- Pro: 1000 AI checks/month, unlimited reading, 20 personalized stories, 10 mock tests
- Unlimited: No limits

---

## Phased Roadmap

### Active Phases

| Phase | Name | Status | Priority |
|-------|------|--------|----------|
| 3 | Compression Pipeline | âŒ Not Started | **TOP** |
| 4 | Personalization | ğŸš§ In Progress | High |
| 5 | Exam Digitization | âŒ Not Started | High |
| 6 | Anki Import | âŒ Not Started | High |
| 7 | Listening & Speaking | ğŸš§ Partial | Medium |
| 8 | Missing UI | âŒ Not Started | Low |
| 9 | Image Cost Visibility | âŒ Not Started | Low |
| 10 | Testing | âŒ Not Started | Low |
| 11 | Mobile App | âŒ Not Started | Low |

### Deferred

- **Image-Based Learning** - Describe images, vision questions (low priority)
- **Email Marketing** - Engagement campaigns (not urgent)

---

### Phase 3: Compression Pipeline
**Goal:** Fix storage costs with serve-first-compress-later pattern

**Status:** âŒ Not Started | **Priority:** TOP

| Feature | Status | Notes |
|---------|--------|-------|
| Compression utilities | âŒ Not Started | lamejs for MP3, sharp for WebP |
| Temp storage for immediate serve | âŒ Not Started | Convex temp storage |
| Background compression jobs | âŒ Not Started | Via scheduler |
| R2 upload after compression | âŒ Not Started | Update URLs after compress |

---

### Phase 4: Personalization
**Goal:** Use your vocabulary and learner profile to generate content tailored to YOU

**Status:** ğŸš§ In Progress | **Priority:** High

| Feature | Status | Notes |
|---------|--------|-------|
| Multi-language story generation | âœ… Complete | Japanese, English, French with JLPT/CEFR constraints |
| CEFR grammar constraints | âœ… Complete | `english_grammar_constraints.json`, `french_grammar_constraints.json` |
| Admin story generation UI | âœ… Complete | Detailed prompts, direct generation from admin panel |
| Content topology/gaps analysis | âœ… Complete | `/admin/stories/topology` endpoint + UI |
| AI story suggestions | âœ… Complete | On-demand suggestions based on gaps and interests |
| User interest analytics | âœ… Complete | Convex `getInterestAnalytics` query |
| Vocabulary coverage check | âŒ Not Started | Check user knows enough words before recommending |
| Story recommendation by known words | âŒ Not Started | Personalized ranking based on vocabulary |
| Stories from your words | âŒ Not Started | Generate stories featuring words user is learning |
| Questions from your weak areas | âŒ Not Started | Generate questions targeting learner profile gaps |
| i+1 comprehensible input | âŒ Not Started | Content at user's level + 1 new concept |
| Integration with flashcards | âŒ Not Started | Link stories to vocabulary learning |

---

### Phase 5: Exam Digitization & Q&A
**Goal:** Build question bank from real exams with AI explanations

**Status:** âŒ Not Started | **Priority:** High

| Feature | Status | Notes |
|---------|--------|-------|
| Source official practice tests | âŒ Not Started | JLPT, TOEFL, DELF official materials |
| Question bank schema | âŒ Not Started | question, options, answer, explanation, source, year |
| Exam parser/digitizer | âŒ Not Started | Parse PDF/images into structured questions |
| Question-level Q&A | âŒ Not Started | "Why is this wrong?" with AI explanation |
| Q&A conversation history | âŒ Not Started | Store follow-up questions per question |

**Data sources to acquire:**
- JLPT: Official JLPT practice workbooks, æ—¥æœ¬èªèƒ½åŠ›è©¦é¨“ past papers
- TOEFL: ETS official practice tests, TPO materials
- DELF/DALF: Official CIEP/France Ã‰ducation sample papers

---

### Phase 6: Anki Import
**Goal:** Import existing Anki decks to bootstrap vocabulary

**Status:** âŒ Not Started | **Priority:** High

| Feature | Status | Notes |
|---------|--------|-------|
| Parse .apkg files | âŒ Not Started | Anki export format (SQLite + media) |
| Map Anki fields to vocabulary | âŒ Not Started | Handle different note types |
| Import media (audio/images) | âŒ Not Started | Extract and store in content library |
| Duplicate detection | âŒ Not Started | Skip words already in user's vocabulary |
| Preview before import | âŒ Not Started | Let user review/select what to import |

**Tech notes:**
- .apkg files are ZIP archives containing SQLite database + media folder
- Need to handle various Anki note types (Basic, Cloze, Japanese-specific)
- Consider import limits for free tier

---

### Phase 7: Listening & Speaking
**Goal:** Dictation and shadowing as question types, not separate modes

**Status:** ğŸš§ Partial | **Priority:** Medium

| Feature | Status | Notes |
|---------|--------|-------|
| Shadowing backend | âœ… Complete | `shadowingPractices` table, submit mutation |
| Shadowing accuracy scoring | âœ… Complete | Accuracy score stored, learner model updated |
| Audio comprehension | âœ… Complete | Video quiz with listening questions |
| Dictation questions | âŒ Not Started | Listen, type what you hear, compare to transcript |
| Shadowing questions | âŒ Not Started | Repeat after audio, compare recording |
| AI conversation partner | âŒ Not Started | Future: AI teacher you can talk to |

**Tech notes:**
- Speech recognition: Web Speech API or Whisper API
- These are question types within the existing quiz system, not separate practice modes

---

### Phase 8: Missing UI for Existing Data
**Goal:** Surface data that's already being collected

**Status:** âŒ Not Started | **Priority:** Low

| Feature | Status | Notes |
|---------|--------|-------|
| Question history page | âŒ Not Started | All answered questions with review |
| Content preferences in onboarding | âŒ Not Started | Backend exists, need UI |
| Gradebook with all attempts | âŒ Not Started | Centralized view of exam/quiz attempts |

---

### Phase 9: Image Cost Visibility
**Goal:** Track and understand image generation costs

**Status:** âŒ Not Started | **Priority:** Low

| Feature | Status | Notes |
|---------|--------|-------|
| Image cost tracking in admin | âŒ Not Started | Per-deck cost breakdown |
| Content reuse metrics | âŒ Not Started | Images shared across words |

---

### Phase 10: Testing
**Goal:** Add unit and integration tests once features stabilize

**Status:** âŒ Not Started | **Priority:** Low (wait for stability)

| Feature | Status | Notes |
|---------|--------|-------|
| Unit tests for Convex functions | âŒ Not Started | Test learner model, flashcard logic, etc. |
| Component tests (React Testing Library) | âŒ Not Started | Key UI components |
| Integration tests | âŒ Not Started | Full user flows (review session, quiz, etc.) |
| E2E tests (Playwright) | âŒ Not Started | Critical paths: auth, payment, study session |
| CI pipeline | âŒ Not Started | Run tests on PR, block merge on failure |

**Tech notes:**
- Wait until core features are stable before investing in tests
- Start with Convex function unit tests (most bang for buck)
- Use Vitest for unit/component tests
- Playwright already in dependencies for E2E

---

### Phase 11: Mobile App
**Goal:** React Native app for iOS/Android with shared Convex backend

**Status:** âŒ Not Started | **Priority:** Low (post-MVP)

| Feature | Status | Notes |
|---------|--------|-------|
| React Native + Expo setup | âŒ Not Started | Monorepo structure with web |
| Shared Convex client | âŒ Not Started | Same backend, mobile UI |
| Core screens (Dashboard, Library, Flashcards) | âŒ Not Started | Mobile-optimized layouts |
| Offline support | âŒ Not Started | Cache flashcards for offline review |
| Push notifications | âŒ Not Started | Streak reminders, review nudges |
| App Store / Play Store submission | âŒ Not Started | Store listings, screenshots |

**Tech notes:**
- Web app is priority; mobile comes after web is polished
- Share Convex backend and business logic
- Use Expo for faster development and easier deployment

---

## Next Steps

### Immediate
| Task | Priority | Notes |
|------|----------|-------|
| Phase 3: Compression Pipeline | **TOP** | Fix storage costs |

### Short-term
| Task | Priority | Notes |
|------|----------|-------|
| Phase 4: Vocabulary coverage check | High | First step toward personalization |
| Phase 4: Questions from weak areas | High | Use learner profile for targeting |
| Phase 5: Source exam content | High | Find and digitize materials |

### Medium-term
| Task | Priority | Notes |
|------|----------|-------|
| Phase 4: i+1 content generation | High | Core differentiator |
| Phase 6: Anki import | High | Bootstrap user vocabulary |
| Phase 7: Add dictation question type | Medium | Backend shadowing exists |

---

## Platform Strategy

**Decision: React (Web) + React Native (Mobile)**

**Current approach:**
1. **Web app with React** - Current implementation in `/web`
2. **Future mobile with React Native** - Cross-platform iOS/Android
3. **Shared Convex backend** - Single source of truth for data
4. **Clerk for auth** - Unified authentication across platforms

---

## Tech Stack

| Layer | Technology |
|-------|------------|
| **Frontend (Web)** | React + Vite + TailwindCSS |
| **Frontend (Mobile)** | React Native + Expo (future) |
| **Backend** | Convex (database + functions) |
| **Auth** | Clerk |
| **AI** | OpenRouter (Claude/GPT), Gemini |
| **Audio** | ElevenLabs TTS |
| **Images** | DALL-E 3 |

---

## Ongoing Research

| Research Area | Purpose | Status |
|---------------|---------|--------|
| **Duolingo engagement study** | Understand gamification, streaks, XP, lesson structure | ğŸ“š Ongoing |
| **Competitor analysis** | WaniKani, Bunpro, Anki, Lingodeer patterns | ğŸ“š Ongoing |
| **Exam format research** | Deep dive into each exam's actual format/rubrics | ğŸ“š Ongoing |

---

## Architecture Considerations

### Data Models (Implemented in Convex)

```
User
â”œâ”€â”€ languages: [Language]           # Languages user is learning
â”œâ”€â”€ targetExams: [Exam]             # Exams user is preparing for
â””â”€â”€ emailPreferences                # Email marketing settings

VocabularyItem (enhanced)
â”œâ”€â”€ language: Language
â”œâ”€â”€ word, reading, definitions
â”œâ”€â”€ sourceType: story | manual | import | youtube
â”œâ”€â”€ masteryState: new | learning | tested | mastered
â”œâ”€â”€ flashcards: [Flashcard]
â”œâ”€â”€ userSentences: [UserSentence]
â””â”€â”€ reviewHistory: [Review]

Flashcard
â”œâ”€â”€ vocabularyItemId
â”œâ”€â”€ sentence, translation, audioUrl
â”œâ”€â”€ createdAt
â”œâ”€â”€ nextRefreshAt
â””â”€â”€ reviewData: SRS fields

UserSentence
â”œâ”€â”€ vocabularyItemId
â”œâ”€â”€ sentence
â”œâ”€â”€ aiVerification: VerificationResult
â”œâ”€â”€ createdAt
â””â”€â”€ corrections

MockTest
â”œâ”€â”€ language, examType
â”œâ”€â”€ sections: [TestSection]
â”œâ”€â”€ score, completedAt
â””â”€â”€ vocabularyTargeted: [VocabularyItem]

YouTubeContent
â”œâ”€â”€ videoId, title
â”œâ”€â”€ language
â”œâ”€â”€ transcript: tokenized
â”œâ”€â”€ questions: [Question]
â””â”€â”€ vocabularyExtracted: [VocabularyItem]
```

### Subscription & Usage Tracking

```
Subscription
â”œâ”€â”€ userId
â”œâ”€â”€ tier: free | basic | pro | unlimited
â”œâ”€â”€ startDate, renewalDate
â””â”€â”€ status: active | cancelled | expired

UsageRecord
â”œâ”€â”€ userId
â”œâ”€â”€ period: { month, year }
â”œâ”€â”€ aiVerifications: Int
â”œâ”€â”€ storiesRead: Int
â”œâ”€â”€ personalizedStoriesGenerated: Int
â”œâ”€â”€ mockTestsGenerated: Int
â””â”€â”€ updatedAt

UsageLimits (per tier)
â”œâ”€â”€ tier
â”œâ”€â”€ aiVerificationsPerMonth
â”œâ”€â”€ storiesPerMonth
â”œâ”€â”€ personalizedStoriesPerMonth
â””â”€â”€ mockTestsPerMonth
```

---

## Decisions Made

1. **Branding: SanLang**
   - ä¸‰ (san) = three in Japanese + Lang = language
   - Reflects trilingual founder (English, French, Japanese)
   - Domain to register: sanlang.app or sanlang.com

2. **User accounts: Freemium model**
   - Browse content without account
   - Account required to: save vocabulary, get tested, track progress
   - Reduces friction for new users while encouraging signup

3. **Content sources: Official sources**
   - JLPT vocabulary from official JLPT sources
   - TOEFL/SAT/GRE from official test prep materials
   - DELF/DALF from official French certification sources

4. **Auth: Clerk**
   - Replaces Firebase Auth
   - Better Convex integration
   - Built-in user management UI

5. **Database: Convex**
   - Real-time sync
   - TypeScript-first
   - Serverless functions

---

## Archived: Completed Work

<details>
<summary>Phase 0: Infrastructure âœ…</summary>

| Task | Status |
|------|--------|
| Convex schema (all tables) | âœ… Complete |
| Convex functions (vocabulary, flashcards, subscriptions, etc.) | âœ… Complete |
| Clerk auth integration | âœ… Complete |
| Remove Firebase | âœ… Complete |
| Deploy schema to Convex | âœ… Complete |

</details>

<details>
<summary>Phase 0.25: Onboarding & Learning Loop âœ…</summary>

| Feature | Status |
|---------|--------|
| Dashboard page | âœ… Complete |
| Simplified navigation | âœ… Complete |
| Combined Learn page | âœ… Complete |
| Sentence context saving | âœ… Complete |
| Onboarding loop explanation | âœ… Complete |

</details>

<details>
<summary>Phase 0.3: Guided Study Sessions âœ…</summary>

| Feature | Status |
|---------|--------|
| Session infrastructure | âœ… Complete |
| Session page with activity flow | âœ… Complete |
| Embedded review/input/output components | âœ… Complete |
| Session completion screen | âœ… Complete |
| Streak tracking | âœ… Complete |
| Dashboard redesign | âœ… Complete |
| Navigation simplification (3 tabs) | âœ… Complete |

</details>

<details>
<summary>Phase 0.5: Analytics & Quick Wins âœ…</summary>

| Feature | Status |
|---------|--------|
| PostHog integration | âœ… Complete |
| AI failure metrics | âœ… Complete |
| Manual vocab + AI enhance | âœ… Complete |
| Premade flashcard decks | âœ… Complete |
| Content library | âœ… Complete |

</details>

<details>
<summary>Phase 1: Flashcard Foundation âœ…</summary>

| Feature | Status |
|---------|--------|
| Enhanced vocabulary input | âœ… Complete |
| Auto-generated flashcards | âœ… Complete |
| Sentence refresh | âœ… Complete |
| Content rotation | âœ… Complete |
| FSRS spaced repetition | âœ… Complete |
| Audio flashcards (schema) | âœ… Complete |

**Note:** ElevenLabs TTS integration pending.

</details>

<details>
<summary>Phase 2: Active Output Verification âœ…</summary>

| Feature | Status |
|---------|--------|
| Sentence creation | âœ… Complete |
| AI verification | âœ… Complete |
| Mastery tracking | âœ… Complete |
| Feedback loop | âœ… Complete |
| Learner model integration | âœ… Complete |

</details>

<details>
<summary>Multi-Language Foundation âœ…</summary>

| Feature | Status |
|---------|--------|
| Language selection | âœ… Complete |
| Exam-specific vocabulary | âœ… Complete |
| Per-language learner profiles | âœ… Complete |
| Separate content tracks | âœ… Complete |

</details>

<details>
<summary>Practice Exams âœ…</summary>

| Feature | Status |
|---------|--------|
| Exam templates | âœ… Complete |
| Question bank | âœ… Complete |
| Exam attempts | âœ… Complete |
| Exam taking UI | âœ… Complete |
| Exam results UI | âœ… Complete |
| AI grading for essays | âœ… Complete |
| Learner model integration | âœ… Complete |

</details>

<details>
<summary>YouTube Integration âœ…</summary>

| Feature | Status |
|---------|--------|
| Dashboard recommended stories | âœ… Complete |
| YouTube schema with level field | âœ… Complete |
| Stories/Videos toggle in Library | âœ… Complete |
| VideoPage with player | âœ… Complete |
| VideoQuizPage | âœ… Complete |
| Transcript fetch action | âœ… Complete |
| Video question generation | âœ… Complete |
| Video questions by difficulty | âœ… Complete |
| Admin video management | âœ… Complete |

</details>

<details>
<summary>AI Abstraction & Enforcement âœ…</summary>

| Feature | Status |
|---------|--------|
| Centralized generation layer | âœ… Complete |
| Content reuse helpers | âœ… Complete |
| User content history (seen tracking) | âœ… Complete |
| Usage limit checking | âœ… Complete |
| Usage metering | âœ… Complete |
| Monthly usage display | âœ… Complete |

</details>

<details>
<summary>Unified Learner Model âœ…</summary>

| Feature | Status |
|---------|--------|
| Learner profile schema | âœ… Complete |
| Question history | âœ… Complete |
| Daily progress | âœ… Complete |
| Update from all activities | âœ… Complete |
| Weak area detection | âœ… Complete |
| Readiness prediction | âœ… Complete |

</details>

<details>
<summary>Placement Testing âœ…</summary>

| Feature | Status |
|---------|--------|
| Placement test schema | âœ… Complete |
| CAT algorithm (3-PL IRT) | âœ… Complete |
| Adaptive question selection | âœ… Complete |
| Ability estimation | âœ… Complete |
| Level determination | âœ… Complete |
| Placement test UI | âœ… Complete |

</details>

<details>
<summary>Progress Dashboard âœ…</summary>

| Feature | Status |
|---------|--------|
| Progress page | âœ… Complete |
| Skill radar chart | âœ… Complete |
| Weak areas list | âœ… Complete |
| Daily progress charts | âœ… Complete |
| Readiness indicator | âœ… Complete |

</details>

<details>
<summary>Admin Panel âœ…</summary>

| Feature | Status |
|---------|--------|
| Admin dashboard | âœ… Complete |
| Video management | âœ… Complete |
| Story management | âœ… Complete |
| Deck management | âœ… Complete |
| Batch job monitoring | âœ… Complete |
| Admin auth guard | âœ… Complete |

</details>

<details>
<summary>Premade Decks & Content Library âœ…</summary>

| Feature | Status |
|---------|--------|
| Premade decks schema | âœ… Complete |
| Content library | âœ… Complete |
| Drip-feed subscriptions | âœ… Complete |
| Deck import scripts | âœ… Complete |
| Content generation pipeline | âœ… Complete |
| Deck publishing | âœ… Complete |

</details>

---

## Document Control

**Version**: 4.0
**Last Updated**: 2026-01-23
**Status**: Active development - Core complete, focusing on compression and personalization
